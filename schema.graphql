type Counter @entity(immutable: false) {
  id: Bytes!
  index: BigInt!
}

type Condition @entity(immutable: false) {
  id: Bytes! # conditionId
  fpmmIds: [Bytes!]! # Manual reverse mapping to FPMMs
}

type FixedProductMarketMakerCreation @entity(immutable: false) {
  id: Bytes!
  index: BigInt!
  creator: Bytes! # address
  fixedProductMarketMaker: Bytes! # address
  conditionalTokens: Bytes! # address
  collateralToken: Bytes! # address
  conditionIds: [Bytes!]! # bytes32[]
  positionIds: [Bytes!]! # bytes32[]
  fee: BigInt! # uint256
  maxFee: BigInt! # uint256
  endTime: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  solved: Boolean! # bool
  outcomePayouts: [BigInt!] # uint256[] - Payout numerators for each outcome slot
  collateralVolume: BigInt! # uint256 - Total volume in collateral tokens
}

type User @entity(immutable: false) {
  id: Bytes! # address
  index: BigInt!
  address: Bytes! # address
  holdings: [UserHolding!]! @derivedFrom(field: "user")
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type UserHolding @entity(immutable: false){
  id: Bytes! # Set as `${marketAddress}-${userAddress}`
  user: User!
  index: BigInt!
  fpmm: FixedProductMarketMakerCreation!
  balances: [BigInt!]! # uint256[] - Outcome Token Balances
  lpHolding: BigInt! # uint256 - LP Token Balance
}

# 辅助实体：用于将全局的 PositionId 映射回具体的 Market 和 OutcomeIndex
type PositionMap @entity(immutable: true) {
  id: String! # uint256 PositionId to Hex String
  fpmm: FixedProductMarketMakerCreation!
  outcomeIndex: Int!
}

type FPMMFundingAdded @entity(immutable: true) {
  id: Bytes!
  index: BigInt!
  funder: Bytes! # address
  amountsAdded: [BigInt!]! # uint256[]
  sharesMinted: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type FPMMFundingRemoved @entity(immutable: true) {
  id: Bytes!
  index: BigInt!
  funder: Bytes! # address
  amountsRemoved: [BigInt!]! # uint256[]
  collateralRemovedFromFeePool: BigInt! # uint256
  sharesBurnt: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type FPMMBuy @entity(immutable: true) {
  id: Bytes!
  index: BigInt!
  buyer: Bytes! # address
  investmentAmount: BigInt! # uint256
  feeAmount: BigInt! # uint256
  outcomeIndex: BigInt! # uint256
  outcomeTokensBought: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type FPMMSell @entity(immutable: true) {
  id: Bytes!
  index: BigInt!
  seller: Bytes! # address
  returnAmount: BigInt! # uint256
  feeAmount: BigInt! # uint256
  outcomeIndex: BigInt! # uint256
  outcomeTokensSold: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}
