type Counter @entity(immutable: false) {
  id: Bytes!
  index: BigInt!
}

type Condition @entity(immutable: false) {
  id: Bytes! # conditionId
  fpmmIds: [Bytes!]! # Manual reverse mapping to FPMMs
}

type FixedProductMarketMakerCreation @entity(immutable: false) {
  id: Bytes!
  index: BigInt!
  creator: Bytes! # address
  fixedProductMarketMaker: Bytes! # address
  conditionalTokens: Bytes! # address
  collateralToken: Bytes! # address
  conditionIds: [Bytes!]! # bytes32[]
  positionIds: [Bytes!]! # bytes32[]
  fee: BigInt! # uint256
  maxFee: BigInt! # uint256
  endTime: BigInt! # uint256
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
  solved: Boolean! # bool
  outcomePayouts: [BigInt!] # uint256[] - Payout numerators for each outcome slot
  collateralVolume: BigInt! # uint256 - Total volume in collateral tokens
}

type User @entity(immutable: false) {
  id: Bytes! # address
  index: BigInt!
  address: Bytes! # address
  holdings: [UserHolding!]! @derivedFrom(field: "user")
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type UserHolding @entity(immutable: false){
  id: Bytes! # Set as `${marketAddress}-${userAddress}`
  user: User!
  index: BigInt!
  fpmm: FixedProductMarketMakerCreation!
  balances: [BigInt!]! # uint256[] - Outcome Token Balances
  lpHolding: BigInt! # uint256 - LP Token Balance
}

# 辅助实体：用于将全局的 PositionId 映射回具体的 Market 和 OutcomeIndex
type PositionMap @entity(immutable: true) {
  id: String! # uint256 PositionId to Hex String
  fpmm: FixedProductMarketMakerCreation!
  outcomeIndex: Int!
}

enum FPMMFundingType {
  Added
  Removed
}

type FPMMFunding @entity(immutable: true) {
  id: Bytes!
  index: BigInt!
  type: FPMMFundingType!
  fpmm: FixedProductMarketMakerCreation!
  funder: Bytes! # address
  amounts: [BigInt!]! # uint256[] - amountsAdded or amountsRemoved
  shares: BigInt! # uint256 - sharesMinted or sharesBurnt
  collateralRemovedFromFeePool: BigInt # uint256 - Only for Removed
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

enum FPMMTradeType {
  Buy
  Sell
}

type FPMMTrade @entity(immutable: true) {
  id: Bytes!
  index: BigInt!
  type: FPMMTradeType!
  fpmm: FixedProductMarketMakerCreation!
  creator: Bytes! # address - buyer or seller
  collateralAmount: BigInt! # uint256 - investmentAmount or returnAmount
  feeAmount: BigInt! # uint256
  outcomeIndex: BigInt! # uint256
  outcomeTokensAmount: BigInt! # uint256 - outcomeTokensBought or outcomeTokensSold
  outcomeTokenMarginalPrices: [BigDecimal!]!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}

type ConditionalTokensTransfer @entity(immutable: true) {
  id: Bytes!
  index: BigInt!
  fpmm: FixedProductMarketMakerCreation!
  from: Bytes! # address
  to: Bytes! # address
  positionId: Bytes! # bytes32
  outcomeIndex: BigInt!
  value: BigInt!
  blockNumber: BigInt!
  blockTimestamp: BigInt!
  transactionHash: Bytes!
}
